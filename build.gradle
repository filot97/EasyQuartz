/*
 * This build file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java Library project to get you started.
 * For more details take a look at the Java Libraries chapter in the Gradle
 * user guide available at https://docs.gradle.org/3.5/userguide/java_library_plugin.html
 */

buildscript {
	ext {
		springBootVersion = '1.5.6.RELEASE'
	}
	repositories {
		mavenCentral()
	}
	dependencies {
		classpath("org.springframework.boot:spring-boot-gradle-plugin:${springBootVersion}")
	}
}

def eclipseSourceFolders=[
	'src/main/java',
	'src/main/resources',	
	'src/test/java',
	'src/test/resources'
];

def projectsNotInEclipse = ['easyquartz'];  

subprojects {	
	apply plugin: 'java'	
	apply plugin: 'java-library-distribution'
	apply plugin: 'war'	
	apply plugin: 'java-library'
	apply plugin: 'org.springframework.boot'
	apply plugin: 'eclipse'		
	apply plugin: 'eclipse-wtp'	
	apply plugin: 'maven'	
	apply plugin: 'pmd'
	
	group = "net.osi"
	version = "0.0.1"
	
	if (projectsNotInEclipse.contains(project.name)){
		return;		
	}
	
	tasks.eclipse.dependsOn << {	
		for (String sourceFolder: eclipseSourceFolders){
			def resourceDir = new File(project.projectDir, sourceFolder)
			
			if( !resourceDir.exists() && ! resourceDir.mkdirs() ) {				
	    		logger.info("Not able to create eclipse resource dir: %1",resourceDir);
	    	}
		}
	}
	
	eclipse {
	  classpath {
		downloadSources = true // default: true
		downloadJavadoc = false // default: false
	  }
	}
	
	eclipseJdt.doLast {
		File f = file('.settings/org.eclipse.core.resources.prefs')
		f.write('eclipse.preferences.version=1\n')
		f.append('encoding/<project>=utf-8')
	}
	
	/* Continous integration part - use build number in version when 'ci.buildNumber' is set*/
	def buildNr = System.getenv('ci.buildNumber')
  	if (buildNr != null && ! buildNr.isEmpty()){
		version= version + "_"+buildNr
	}
	
	pmd {
		ignoreFailures = true // 분석결과 예외가 발생하면 빌드실패 발생시키는 것을 제외
		reportsDir = file("${buildDir}/pmd-output")
	}
	
	pmdMain {
		reports {
			xml.destination = file("${pmd.reportsDir}/pmd-report.xml")
			xml.enabled = true
		}
	}
	
	/* Setup UTF-8 for compile AND test compilation*/
	[ compileJava, compileTestJava ]*.options*.encoding = 'UTF-8'
	
	sourceCompatibility = 1.8

	configurations {
		providedRuntime
	}
	
	dependencies {
	   // This dependency is exported to consumers, that is to say found on their compile classpath.
    	api 'org.apache.commons:commons-math3:3.6.1'

    	// This dependency is used internally, and not exposed to consumers on their own compile classpath.
    	implementation 'com.google.guava:guava:23.0'    		
	}
}

allprojects{
	repositories {
		mavenCentral()		
	}
}